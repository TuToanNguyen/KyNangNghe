CREATE DATABASE QLDKHP

USE [QLDKHP]
GO

CREATE TABLE GIAOVIEN(
MSCV NVARCHAR(20) NOT NULL,
HOTENCV NVARCHAR(50) NOT NULL,
PRIMARY KEY (MSCV)
)

CREATE TABLE LOP(
MSL NVARCHAR(20) NOT NULL,
TENL NVARCHAR(50) NOT NULL,
MSCV NVARCHAR(20) NOT NULL,
PRIMARY KEY (MSL),
FOREIGN KEY (MSCV) REFERENCES GIAOVIEN(MSCV)
)

CREATE TABLE SINHVIEN(
MSSV NVARCHAR(20) NOT NULL,
HOSV NVARCHAR(50) NOT NULL,
TENSV NVARCHAR(50) NOT NULL,
MSL NVARCHAR(20) NOT NULL,
PRIMARY KEY (MSSV),
FOREIGN KEY (MSL) REFERENCES LOP(MSL)
)

CREATE TABLE HOCPHAN(
MSHP NVARCHAR(20) NOT NULL,
TENHP NVARCHAR(50) NOT NULL,
SOTC INT NOT NULL,
SOTCLT INT NOT NULL,
SOTCTH INT NOT NULL,
PRIMARY KEY (MSHP)
)

CREATE TABLE DANGKY(
HOCKY NVARCHAR(50) NOT NULL,
NAMHOC NVARCHAR(50) NOT NULL,
MSHP NVARCHAR(20) NOT NULL,
MSSV NVARCHAR(20) NOT NULL,
FOREIGN KEY (MSHP) REFERENCES HOCPHAN(MSHP),
FOREIGN KEY (MSSV) REFERENCES SINHVIEN(MSSV)
)

INSERT INTO GIAOVIEN (MSCV, HOTENCV) VALUES ('CV01', 'LE LAN LINH');
INSERT INTO GIAOVIEN (MSCV, HOTENCV) VALUES ('CV02', 'NGUYEN VAN SAU')

INSERT INTO LOP (MSL, TENL, MSCV) VALUES('L01', '12A1', 'CV01');
INSERT INTO LOP (MSL, TENL, MSCV) VALUES('L02', '12A2', 'CV02');

INSERT INTO HOCPHAN (MSHP, TENHP, SOTC, SOTCLT, SOTCTH) VALUES ('HP01', 'TOAN A1', 3, 2, 1);
INSERT INTO HOCPHAN (MSHP, TENHP, SOTC, SOTCLT, SOTCTH) VALUES ('HP02', 'TINHOC', 3, 2, 1);

INSERT INTO SINHVIEN(MSSV, HOSV, TENSV, MSL) VALUES (14004001, 'NGUYEN', 'TU TOAN', 'L01');
INSERT INTO SINHVIEN(MSSV, HOSV, TENSV, MSL) VALUES (14004002, 'NGUYEN', 'TU', 'L01');
INSERT INTO SINHVIEN(MSSV, HOSV, TENSV, MSL) VALUES (14004003, 'NGUYEN', 'TOAN', 'L02');
INSERT INTO SINHVIEN(MSSV, HOSV, TENSV, MSL) VALUES (14004004, 'NGUYEN', 'MINH', 'L02');
INSERT INTO SINHVIEN(MSSV, HOSV, TENSV, MSL) VALUES (14004005, 'NGUYEN', 'LUAN', 'L01');

INSERT INTO DANGKY (HOCKY, NAMHOC, MSHP, MSSV) VALUES (1, 2014-2015, 'HP01', '14004001'); 
INSERT INTO DANGKY (HOCKY, NAMHOC, MSHP, MSSV) VALUES (1, 2015-2016, 'HP02', '14004002'); 
INSERT INTO DANGKY (HOCKY, NAMHOC, MSHP, MSSV) VALUES (1, 2015-2016, 'HP01', '14004002'); 
INSERT INTO DANGKY (HOCKY, NAMHOC, MSHP, MSSV) VALUES (1, 2015-2016, 'HP02', '14004003'); 
INSERT INTO DANGKY (HOCKY, NAMHOC, MSHP, MSSV) VALUES (1, 2016-2017, 'HP02', '14004001'); 

SELECT SINHVIEN.MSSV, SINHVIEN.HOSV, SINHVIEN.TENSV, SINHVIEN.MSL FROM SINHVIEN, LOP, GIAOVIEN WHERE LOP.MSCV = GIAOVIEN.MSCV and LOP.MSL = SINHVIEN.MSL AND GIAOVIEN.MSCV = 'CV01'

SELECT DISTINCT HOCPHAN.MSHP, HOCPHAN.TENHP FROM HOCPHAN, DANGKY WHERE DANGKY.NAMHOC = 2014-2015

SELECT *FROM DANGKY ORDER BY MSSV ASC 